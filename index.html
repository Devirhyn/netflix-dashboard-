<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Netflix Dashboard
  <style>
    :root{
      --bg1:#0b1220; --bg2:#0f1a33; --card:#111c33; --card2:#0f1730;
      --text:#e9eefc; --muted:#a7b3d6; --accent:#6ee7ff; --accent2:#a78bfa;
      --border:rgba(255,255,255,.08);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background: radial-gradient(1200px 700px at 10% 0%, #16254a 0%, transparent 60%),
                  radial-gradient(900px 500px at 90% 10%, #2b1a5a 0%, transparent 55%),
                  linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height:100vh;
    }
    .wrap{
      max-width:1200px;
      margin:0 auto;
      padding:24px;
    }
    header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:16px;
      margin-bottom:16px;
    }
    .title h1{
      font-size:22px;
      margin:0 0 6px 0;
      letter-spacing:.2px;
    }
    .title p{margin:0;color:var(--muted);font-size:13px;max-width:720px;line-height:1.4}
    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      background:rgba(255,255,255,.03);
      border:1px solid var(--border);
      padding:10px 12px;
      border-radius:14px;
    }
    label{font-size:12px;color:var(--muted)}
    select{
      background:rgba(255,255,255,.05);
      color:var(--text);
      border:1px solid var(--border);
      border-radius:10px;
      padding:8px 10px;
      outline:none;
    }
    .grid-kpi{
      display:grid;
      grid-template-columns: repeat(5, minmax(0,1fr));
      gap:12px;
      margin:14px 0 16px 0;
    }
    .kpi{
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid var(--border);
      border-radius:16px;
      padding:12px 12px;
      min-height:82px;
    }
    .kpi .label{font-size:11px;color:var(--muted);margin-bottom:6px}
    .kpi .value{font-size:20px;font-weight:700;margin:0 0 2px 0}
    .kpi .note{font-size:11px;color:var(--muted)}
    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:12px;
    }
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--border);
      border-radius:16px;
      padding:14px;
      overflow:hidden;
      position:relative;
    }
    .card h2{
      font-size:14px;
      margin:0 0 10px 0;
      font-weight:650;
      color:#f1f5ff;
      letter-spacing:.2px;
    }
    .subgrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      margin-top:12px;
    }
    .chartBox{height:280px;}
    .chartBox.small{height:240px;}
    canvas{width:100% !important; height:100% !important;}
    .hint{
      margin-top:10px;
      padding:10px 12px;
      border-radius:14px;
      border:1px dashed rgba(110,231,255,.25);
      background:rgba(110,231,255,.06);
      color:#d9fbff;
      font-size:12px;
      line-height:1.4;
    }
    .footer{
      margin-top:16px;
      color:var(--muted);
      font-size:12px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      border:1px solid rgba(167,139,250,.25);
      background:rgba(167,139,250,.08);
      color:#efe9ff;
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
    }
    @media (max-width: 1100px){
      .grid-kpi{grid-template-columns: repeat(2, minmax(0,1fr));}
    }
    @media (max-width: 900px){
      header{flex-direction:column;}
      .grid{grid-template-columns:1fr;}
      .subgrid{grid-template-columns:1fr;}
      .grid-kpi{grid-template-columns: repeat(2, minmax(0,1fr));}
    }
    .loading{
      position:fixed; inset:0;
      display:flex; align-items:center; justify-content:center;
      background:rgba(10,14,26,.75);
      backdrop-filter: blur(6px);
      z-index:999;
    }
    .loading .box{
      width:min(520px, 92vw);
      border:1px solid var(--border);
      border-radius:18px;
      padding:16px;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    }
    .loading .bar{
      height:8px;
      border-radius:999px;
      background:rgba(255,255,255,.08);
      overflow:hidden;
      margin-top:10px;
    }
    .loading .bar > div{
      height:100%;
      width:40%;
      background:linear-gradient(90deg, var(--accent), var(--accent2));
      border-radius:999px;
      animation: move 1.1s infinite ease-in-out;
    }
    @keyframes move{
      0%{transform:translateX(-20%);}
      50%{transform:translateX(140%);}
      100%{transform:translateX(-20%);}
    }
  </style>
</head>
<body>
  <div class="loading" id="loading">
    <div class="box">
      <div style="font-weight:700;font-size:14px;margin-bottom:6px;">Loading JSON → Building Dashboard…</div>
      <div style="color:var(--muted);font-size:12px;line-height:1.4;">
        We read your JSON file, aggregate (count/top-5), then render charts.
      </div>
      <div class="bar"><div></div></div>
    </div>
  </div>

  <div class="wrap">
    <header>
      <div class="title">
        <h1>Executive Content Dashboard</h1>
        <p>
          Single-page dashboard from a JSON file. Designed for “top management” questions:
          portfolio mix, growth trend, top markets (country), top categories (genre), and audience segment (rating).
        </p>
      </div>
      <div class="controls">
        <div>
          <label for="typeFilter">Filter Type</label><br/>
          <select id="typeFilter">
            <option value="ALL">All</option>
            <option value="Movie">Movie</option>
            <option value="TV Show">TV Show</option>
          </select>
        </div>
      </div>
    </header>

    <section class="grid-kpi">
      <div class="kpi">
        <div class="label">Total Titles</div>
        <div class="value" id="kpiTotal">—</div>
        <div class="note">after filter</div>
      </div>
      <div class="kpi">
        <div class="label">Mix (Movies vs TV)</div>
        <div class="value" id="kpiMix">—</div>
        <div class="note">percent split</div>
      </div>
      <div class="kpi">
        <div class="label">Top Country</div>
        <div class="value" id="kpiCountry">—</div>
        <div class="note">by title count</div>
      </div>
      <div class="kpi">
        <div class="label">Top Genre</div>
        <div class="value" id="kpiGenre">—</div>
        <div class="note">by occurrences</div>
      </div>
      <div class="kpi">
        <div class="label">Avg Movie Duration</div>
        <div class="value" id="kpiDuration">—</div>
        <div class="note">minutes (movies only)</div>
      </div>
    </section>

    <section class="grid">
      <div class="card">
        <h2>Titles Added per Year (Trend)</h2>
        <div class="chartBox"><canvas id="chartTrend"></canvas></div>
        <div class="hint">
          Management use: “Is our content acquisition accelerating or slowing down?”
        </div>
      </div>

      <div class="card">
        <h2>Portfolio Mix</h2>
        <div class="chartBox small"><canvas id="chartType"></canvas></div>
        <div class="hint">
          Management use: “Are we balanced between Movies and TV Shows?”
        </div>
      </div>
    </section>

    <section class="subgrid">
      <div class="card">
        <h2>Top 5 Countries</h2>
        <div class="chartBox small"><canvas id="chartCountries"></canvas></div>
      </div>
      <div class="card">
        <h2>Top 5 Ratings</h2>
        <div class="chartBox small"><canvas id="chartRatings"></canvas></div>
      </div>
      <div class="card">
        <h2>Top 5 Genres</h2>
        <div class="chartBox small"><canvas id="chartGenres"></canvas></div>
      </div>
      <div class="card">
        <h2>Top 5 Titles (Longest Duration)</h2>
        <div style="border:1px solid var(--border); border-radius:14px; overflow:hidden;">
          <table style="width:100%; border-collapse:collapse;">
            <thead style="background:rgba(255,255,255,.04);">
              <tr>
                <th style="text-align:left; padding:10px; font-size:12px; color:var(--muted);">Title</th>
                <th style="text-align:right; padding:10px; font-size:12px; color:var(--muted);">Duration</th>
              </tr>
            </thead>
            <tbody id="topTitles"></tbody>
          </table>
        </div>
        <div class="hint">
          Management use: “Which titles are ‘big bets’ (long runtime)?”
        </div>
      </div>
    </section>

  </div>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.1/dist/chart.umd.min.js"></script>

  <script>
    // ====== 1) SET YOUR JSON FILE NAME HERE ======
    const DATA_URL = "./sample_titles_500.json";

    // ====== 2) Small helpers ======
    const clean = (s) => (s ?? "").toString().trim();
    const isMissing = (s) => !s || s === "Not Given" || s === "N/A" || s === "Unknown";

    function splitList(s){
      // Split comma-separated values like "United States, Canada"
      return clean(s)
        .split(",")
        .map(x => x.trim())
        .filter(x => x && !isMissing(x));
    }

    function topNCount(items, getterFn, n=5){
      const map = new Map();
      for (const it of items){
        const values = getterFn(it);
        for (const v of values){
          map.set(v, (map.get(v) || 0) + 1);
        }
      }
      const arr = [...map.entries()].sort((a,b)=>b[1]-a[1]).slice(0,n);
      return { labels: arr.map(x=>x[0]), values: arr.map(x=>x[1]) };
    }

    function countBy(items, key){
      const map = new Map();
      for (const it of items){
        const v = clean(it[key]);
        if (!v) continue;
        map.set(v, (map.get(v) || 0) + 1);
      }
      return map;
    }

    function formatInt(n){
      return new Intl.NumberFormat().format(n);
    }

    // ====== 3) Load data ======
    let RAW = [];
    let charts = {};

    async function load(){
      const res = await fetch(DATA_URL, { cache: "no-store" });
      if(!res.ok){
        throw new Error("Failed to load JSON: " + res.status + " " + res.statusText);
      }
      const json = await res.json();
      if(!Array.isArray(json)){
        throw new Error("JSON must be an array of objects. Example: [ {..}, {..} ]");
      }
      return json;
    }

    // ====== 4) Build dashboard ======
    function applyFilter(){
      const typeFilter = document.getElementById("typeFilter").value;
      const filtered = RAW.filter(r => {
        if(typeFilter === "ALL") return true;
        return clean(r.type) === typeFilter;
      });
      return filtered;
    }

    function computeKPIs(rows){
      const total = rows.length;
      const movies = rows.filter(r => clean(r.type) === "Movie").length;
      const tv = rows.filter(r => clean(r.type) === "TV Show").length;

      const mix = total ? `${Math.round((movies/total)*100)}% / ${Math.round((tv/total)*100)}%` : "—";

      const topCountry = topNCount(rows, r => splitList(r.country), 1);
      const topGenre = topNCount(rows, r => splitList(r.listed_in), 1);

      const movieDurations = rows
        .filter(r => clean(r.type) === "Movie" && Number.isFinite(+r.duration_reg_num))
        .map(r => +r.duration_reg_num);
      const avgDur = movieDurations.length
        ? Math.round(movieDurations.reduce((a,b)=>a+b,0) / movieDurations.length)
        : null;

      return {
        total, movies, tv, mix,
        topCountry: topCountry.labels[0] ? `${topCountry.labels[0]}` : "—",
        topGenre: topGenre.labels[0] ? `${topGenre.labels[0]}` : "—",
        avgDur: avgDur ? `${avgDur}` : "—"
      };
    }

    function computeTrend(rows){
      const byYear = countBy(rows, "year_added");
      const years = [...byYear.keys()].map(x => +x).filter(Number.isFinite).sort((a,b)=>a-b);
      const values = years.map(y => byYear.get(String(y)) || byYear.get(y) || 0);
      return { years, values };
    }

    function computeTop5(rows){
      const topCountries = topNCount(rows, r => splitList(r.country), 5);
      const topGenres = topNCount(rows, r => splitList(r.listed_in), 5);
      const topRatings = topNCount(rows, r => [clean(r.rating)].filter(x=>x && !isMissing(x)), 5);
      return { topCountries, topGenres, topRatings };
    }

    function computeTopTitles(rows){
      // show top 5 by duration_reg_num (works best for Movie; TV shows may be "seasons" in some datasets)
      const sorted = [...rows]
        .filter(r => Number.isFinite(+r.duration_reg_num) && clean(r.title))
        .sort((a,b) => (+b.duration_reg_num) - (+a.duration_reg_num))
        .slice(0,5);
      return sorted.map(r => ({
        title: r.title,
        duration: r.duration
      }));
    }

    // ====== 5) Render UI ======
    function setKPI(id, value){ document.getElementById(id).textContent = value; }

    function renderKPIs(k){
      setKPI("kpiTotal", formatInt(k.total));
      setKPI("kpiMix", k.mix);
      setKPI("kpiCountry", k.topCountry);
      setKPI("kpiGenre", k.topGenre);
      setKPI("kpiDuration", k.avgDur);
    }

    function renderTopTitles(rows){
      const top = computeTopTitles(rows);
      const tbody = document.getElementById("topTitles");
      tbody.innerHTML = top.map(t => `
        <tr style="border-top:1px solid rgba(255,255,255,.06);">
          <td style="padding:10px; font-size:12px;">${escapeHtml(t.title)}</td>
          <td style="padding:10px; font-size:12px; text-align:right; color:var(--muted);">${escapeHtml(t.duration)}</td>
        </tr>
      `).join("");
    }

    function escapeHtml(str){
      return (str ?? "").toString()
        .replaceAll("&","&amp;").replaceAll("<","&lt;")
        .replaceAll(">","&gt;").replaceAll("\"","&quot;")
        .replaceAll("'","&#039;");
    }

    // ====== 6) Charts ======
    function initCharts(){
      const baseOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { labels: { color: "#e9eefc" } },
          tooltip: { enabled: true }
        },
        scales: {
          x: { ticks: { color: "#a7b3d6" }, grid: { color: "rgba(255,255,255,.06)" } },
          y: { ticks: { color: "#a7b3d6" }, grid: { color: "rgba(255,255,255,.06)" } }
        }
      };

      charts.trend = new Chart(document.getElementById("chartTrend"), {
        type: "line",
        data: { labels: [], datasets: [{ label: "Titles", data: [], tension: 0.25, fill: false }] },
        options: baseOptions
      });

      charts.type = new Chart(document.getElementById("chartType"), {
        type: "doughnut",
        data: { labels: ["Movies","TV Shows"], datasets: [{ label: "Count", data: [0,0] }] },
        options: {
          responsive:true,
          maintainAspectRatio:false,
          plugins:{ legend:{ position:"bottom", labels:{ color:"#e9eefc" } } }
        }
      });

      charts.countries = new Chart(document.getElementById("chartCountries"), {
        type: "bar",
        data: { labels: [], datasets: [{ label: "Titles", data: [] }] },
        options: { ...baseOptions, indexAxis: "y" }
      });

      charts.ratings = new Chart(document.getElementById("chartRatings"), {
        type: "bar",
        data: { labels: [], datasets: [{ label: "Titles", data: [] }] },
        options: baseOptions
      });

      charts.genres = new Chart(document.getElementById("chartGenres"), {
        type: "bar",
        data: { labels: [], datasets: [{ label: "Occurrences", data: [] }] },
        options: baseOptions
      });
    }

    function updateCharts(rows){
      const k = computeKPIs(rows);
      const trend = computeTrend(rows);
      const top = computeTop5(rows);

      // Trend
      charts.trend.data.labels = trend.years;
      charts.trend.data.datasets[0].data = trend.values;
      charts.trend.update();

      // Type mix
      charts.type.data.datasets[0].data = [k.movies, k.tv];
      charts.type.update();

      // Top 5
      charts.countries.data.labels = top.topCountries.labels;
      charts.countries.data.datasets[0].data = top.topCountries.values;
      charts.countries.update();

      charts.ratings.data.labels = top.topRatings.labels;
      charts.ratings.data.datasets[0].data = top.topRatings.values;
      charts.ratings.update();

      charts.genres.data.labels = top.topGenres.labels;
      charts.genres.data.datasets[0].data = top.topGenres.values;
      charts.genres.update();

      // Table
      renderTopTitles(rows);
    }

    function refresh(){
      const rows = applyFilter();
      renderKPIs(computeKPIs(rows));
      updateCharts(rows);
    }

    // ====== 7) Boot ======
    (async function(){
      try{
        RAW = await load();
        initCharts();
        refresh();
        document.getElementById("typeFilter").addEventListener("change", refresh);
      }catch(err){
        alert(err.message);
        console.error(err);
      }finally{
        document.getElementById("loading").style.display = "none";
      }
    })();
  </script>
</body>
</html>
